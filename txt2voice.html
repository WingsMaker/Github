<!DOCTYPE html>
<html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="mobile-web-app-capable" content="yes">
<Title>Text to Speech App</Title>
<head>
</head>
<body>
<div id="html">
<h3><a id="a-title" href="https://wingsmaker.github.io/Github/Index.html">WingsMaker</a></h3>
<h1>Text to Speech App</h1>

<br>
<input type="button" onClick="reset()" value="Clear"/>
<input type="file" id="fileinput" />
<div id="header"></div>	
<form>
<textarea id='msg' name="Message" rows="25" cols="80" valign="top" style="font-size:12px; border:solid 1px orange;"></textarea>
<br>
<div id="result"></div>
<br>
<input type="button" onClick="SpeakEnglish()" value="English"/>
<input type="button" onClick="SpeakChinese()" value="Chinese (中文)"/>
<input type="button" onClick="SpeakMalay()" value="Melayu"/>
<input type="button" onClick="SpeakIndonesian()" value="Indonesia"/>
<br>
<input type="button" onClick="SpeakTamil()" value="தமிழ் (Tamil)"/>
<input type="button" onClick="SpeakHindi()" value="हिन्दी (Hindi)"/>
<input type="button" onClick="SpeakJapanese()" value="日本語"/>
<input type="button" onClick="SpeakKorean()" value="한국의"/>
<br/>
<input type="button" onClick="SpeakGerman()" value="German"/>
<input type="button" onClick="SpeakFrench()" value="French"/>
<input type="button" onClick="SpeakDutch()" value="Dutch"/>
<input type="button" onClick="SpeakSpanish()" value="Spanish"/>
<input type="button" onClick="SpeakItalian()" value="Italian"/>

</form>
<hr>
</body>

<script>
console.clear();

const queryString = window.location.search;
const urlParams = new URLSearchParams(queryString);
const inptxt = urlParams.get('msg');
const langcode = urlParams.get('lang');

const synth = window.speechSynthesis;
let voice = new SpeechSynthesisUtterance();
voice.volume = 1;
voice.rate = 1;
voice.pitch = 1; // Can be 0, 1, or 2

document.getElementById('fileinput').addEventListener('change', readSingleFile, false);

if (inptxt != null) {
	document.getElementById("msg").innerHTML = inptxt;	
	if (langcode != null) {
		voice.lang = langcode;
	}
	voice.text = inptxt;
	synth.speak(voice);
}


function readSingleFile(evt) {
	var f = evt.target.files[0]; 
	if (f) {
		var r = new FileReader();
		r.onload = function(e) { 
			document.getElementById('msg').value = e.target.result
	  }
		r.readAsText(f);
	} else { 
		alert("Failed to load file");
	}
}
	
function reset() {
	document.getElementById("msg").innerHTML = "";
}


function SpeakEnglish() {
	Speak("en-US");
}


function SpeakChinese() {
	Speak("zh-TW");
}
	
function SpeakJapanese() {
	Speak("ja-JP");
}

function SpeakKorean() {
	Speak("ko-KR");
}

function SpeakMalay() {
	Speak("ms-MY");
}


function SpeakIndonesian() {
	Speak("id-ID");
}

function SpeakTamil() {
	Speak("ta-SG");
}

function SpeakHindi() {
	Speak("hi-IN");
}

function SpeakGerman() {
	Speak("de-CH");
}

function SpeakFrench() {
	Speak("fr-FR");
}


function SpeakDutch() {
	Speak("nl-NL");
}

function SpeakSpanish() {
	Speak("es-ES");
}

function SpeakItalian() {
	Speak("it-IT");
}

function Speak(lang) {
	msg = document.getElementById('msg').value;
	if (msg == "") {
		return;
	}
	voice.text = msg;
	voice.lang = lang;
	synth.speak(voice);
	url_encode(lang, msg);
}

function url_encode(lang, msg) {
	var base_url = window.location.href.split("?")[0] + "?";
	var codedString = base_url + "dec=";
	var encoded_uri = encodeURIComponent(msg);
	codedString =  codedString + encoded_uri;
	codedString = "<b>Share this link with others : </b><a href='" + base_url;
	codedString = codedString + "lang=" + lang + "&";
	codedString = codedString + "msg=" + encoded_uri + "'>you got a voice message.</a>";
	document.getElementById("result").innerHTML = codedString;
}


</script>
</html>